#!/usr/bin/env bash
set -ueo pipefail

node_addr=${node_addr:-cassandra}

# waiting for available port
/docker-entrypoint-initdb.d/wait-for-it ${node_addr}:9042 -t 0 -- echo "Cassandra's node has been started!"

# provisioning node with data
find /docker-entrypoint-initdb.d -type f \
  \( -name \*.cql -printf "cat %p\n" \) , \
  \( -name \*.cql.gz -printf "gzip -kdc %p\n" \) \
  | xargs -I{} bash -c '{}' \
  | cqlsh ${node_addr}

